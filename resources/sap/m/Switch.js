/*!
 * SAP UI development toolkit for HTML5 (SAPUI5/OpenUI5)
 * (c) Copyright 2009-2014 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','./SwitchRenderer','./library','sap/ui/core/Control','sap/ui/core/EnabledPropagator','sap/ui/core/IconPool','sap/ui/core/theming/Parameters'],function(q,S,l,C,E,I,P){"use strict";var a=C.extend("sap.m.Switch",{metadata:{library:"sap.m",properties:{state:{type:"boolean",group:"Misc",defaultValue:false},customTextOn:{type:"string",group:"Misc",defaultValue:""},customTextOff:{type:"string",group:"Misc",defaultValue:""},visible:{type:"boolean",group:"Appearance",defaultValue:true},enabled:{type:"boolean",group:"Data",defaultValue:true},name:{type:"string",group:"Misc",defaultValue:""},type:{type:"sap.m.SwitchType",group:"Appearance",defaultValue:sap.m.SwitchType.Default}},events:{change:{parameters:{state:{type:"boolean"}}}}}});I.insertFontFaceStyle();E.apply(a.prototype,[true]);a.prototype._slide=function(p){if(p>a._OFFPOSITION){p=a._OFFPOSITION}else if(p<a._ONPOSITION){p=a._ONPOSITION}else{p=p}if(this._iCurrentPosition===p){return}this._iCurrentPosition=p;this._$SwitchInner[0].style[sap.ui.getCore().getConfiguration().getRTL()?"right":"left"]=p+"px";this._setTempState(Math.abs(p)<a._SWAPPOINT)};a.prototype._setTempState=function(b){if(this._bTempState===b){return}this._bTempState=b;this._$Handle[0].setAttribute("data-sap-ui-swt",b?this._sOn:this._sOff)};a._getCssParameter=function(p){var g=P.get;return g(p)||g(p+"-"+sap.ui.Device.os.name.toLowerCase())};(function(){var p="sapMSwitch-TRANSITIONTIME",t=a._getCssParameter(p);a._bUseTransition=!!(Number(t));a._TRANSITIONTIME=Number(t)||0}());a._ONPOSITION=Number(a._getCssParameter("sapMSwitch-ONPOSITION"));a._OFFPOSITION=Number(a._getCssParameter("sapMSwitch-OFFPOSITION"));a._SWAPPOINT=Math.abs((a._ONPOSITION-a._OFFPOSITION)/2);a._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.m");a.prototype.onBeforeRendering=function(){var b=a;this._sOn=this.getCustomTextOn()||b._oRb.getText("SWITCH_ON");this._sOff=this.getCustomTextOff()||b._oRb.getText("SWITCH_OFF")};a.prototype.onAfterRendering=function(){var s,b="."+S.CSS_CLASS;s=this.$();this._$Switch=s.find(b);this._$SwitchInner=this._$Switch.children(b+"Inner");this._$Handle=this._$SwitchInner.children(b+"Handle");this._$Checkbox=s.children("input")};a.prototype.ontouchstart=function(e){var t=e.targetTouches[0],b=S.CSS_CLASS;e.setMarked();if(sap.m.touch.countContained(e.touches,this.getId())>1||!this.getEnabled()||e.button){return}this._iActiveTouchId=t.identifier;q.sap.delayedCall(0,this,"focus");this._$Switch.addClass(b+"Pressed").removeClass(b+"Trans");this._bTempState=this.getState();this._iStartPressPosX=t.pageX;this._iPosition=this._$SwitchInner.position().left;this._bDragging=false};a.prototype.ontouchmove=function(e){e.setMarked();e.preventDefault();var t,p,T=sap.m.touch;if(!this.getEnabled()||e.button){return}t=T.find(e.changedTouches,this._iActiveTouchId);if(!t||t.pageX===this._iStartPressPosX){return}this._bDragging=true;p=((this._iStartPressPosX-t.pageX)*-1)+this._iPosition;if(sap.ui.getCore().getConfiguration().getRTL()){p=-p}this._slide(p)};a.prototype.ontouchend=function(e){e.setMarked();var t,T=sap.m.touch,b=q.sap.assert;if(!this.getEnabled()||e.button){return}b(this._iActiveTouchId!==undefined,"expect to already be touching");t=T.find(e.changedTouches,this._iActiveTouchId);if(t){b(!T.find(e.touches,this._iActiveTouchId),"touchend still active");this._$Switch.removeClass(S.CSS_CLASS+"Pressed");this.setState(this._bDragging?this._bTempState:!this._bTempState,true)}};a.prototype.ontouchcancel=a.prototype.ontouchend;a.prototype.onsapselect=function(e){e.setMarked();e.preventDefault();this.setState(!this.getState(),true)};a.prototype.setState=function(s,t){var b,n,c=a,d=S.CSS_CLASS;if(!this.getEnabled()&&t){return this}n=!(this.getState()===s);if(n){this.setProperty("state",s,true)}if(!this._$Switch){return this}s=this.getState();b=s?this._sOn:this._sOff;if(n){this._$Handle[0].setAttribute("data-sap-ui-swt",b);if(this.getName()){this._$Checkbox[0].setAttribute("checked",s);this._$Checkbox[0].setAttribute("value",b)}s?this._$Switch.removeClass(d+"Off").addClass(d+"On"):this._$Switch.removeClass(d+"On").addClass(d+"Off");if(t){if(c._bUseTransition){q.sap.delayedCall(c._TRANSITIONTIME,this,function(){this.fireChange({state:s})},[s])}else{this.fireChange({state:s})}}}this._$Switch.addClass(d+"Trans");this._$SwitchInner.removeAttr("style");return this};return a},true);
